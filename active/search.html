<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>VERN MAX - SEARCH</title>
    <link rel="stylesheet" href="../css/style.css" /> <link rel="icon" type="image/x-icon" href="logo.png" />
    <style id="custom-styles">
        /* Core Theme Variables & Component Mappings - Purple & Dark Grey Theme */
        :root {
            --current-theme-bg: #23272A; /* Dark Blackish Grey */
            --current-theme-text: #E0E1DD; /* Light Grey/Off-white */
            --current-theme-accent: #7F5AF0; /* Vibrant Purple */
            --current-theme-neutral: #2C2F33; /* Slightly lighter Dark Grey for UI elements */
            --current-theme-button-text: #FFFFFF;
            --current-theme-shadow-rgb: 0, 0, 0;
            --current-theme-shadow-opacity-strong: 0.4;
            --current-theme-shadow-opacity-medium: 0.25; /* Slightly increased for better visibility on dark bg */
            --current-theme-shadow-opacity-light: 0.15;
            --current-theme-focus-ring-color: var(--current-theme-accent);

            --bg-color: var(--current-theme-bg);
            --text-color: var(--current-theme-text);
            --iframe-bg: var(--current-theme-bg);
            --footer-text-color: var(--current-theme-text);
            --font-family-main: 'PrimaryFont', sans-serif;
            --sidebar-width: 280px;

            --navbar-bg: var(--current-theme-neutral);
            --navbar-shadow: 0 2px 5px rgba(var(--current-theme-shadow-rgb), var(--current-theme-shadow-opacity-medium));
            --tab-bg: color-mix(in srgb, var(--current-theme-neutral) 85%, var(--current-theme-bg));
            --tab-active-bg: var(--current-theme-accent);
            --tab-border: color-mix(in srgb, var(--current-theme-neutral) 60%, var(--current-theme-text));
            --tab-hover-bg: color-mix(in srgb, var(--current-theme-neutral) 70%, var(--current-theme-accent));

            --button-bg: var(--current-theme-accent);
            --button-hover-bg: color-mix(in srgb, var(--current-theme-accent) 80%, var(--current-theme-text));
            --button-text-color: var(--current-theme-button-text);

            --input-bg: color-mix(in srgb, var(--current-theme-neutral) 90%, var(--current-theme-bg));
            --input-focus-bg: var(--current-theme-bg);
            --input-focus-shadow: 0 0 0 2px color-mix(in srgb, var(--current-theme-focus-ring-color) 50%, transparent);

            --sidebar-bg: color-mix(in srgb, var(--current-theme-neutral) 95%, var(--current-theme-bg));
            --sidebar-item-hover-bg: var(--current-theme-accent);
            --sidebar-border-color: color-mix(in srgb, var(--current-theme-neutral) 70%, var(--current-theme-text));
            --sidebar-outline-color: color-mix(in srgb, var(--current-theme-accent) 60%, transparent);

            --dropdown-bg: var(--input-bg);
            --dropdown-hover-bg: color-mix(in srgb, var(--input-bg) 80%, var(--current-theme-text));
            --dropdown-item-hover-bg: var(--button-hover-bg);
            --dropdown-text-color: var(--text-color);
        }

        /* No other theme body.theme-* classes needed as it's a single theme now */

        html, body {
            margin: 0; padding: 0; border: none; box-sizing: border-box;
            width: 100%; height: 100%; overflow: hidden;
            font-family: var(--font-family-main);
            background-color: var(--bg-color); color: var(--text-color);
            display: flex;
        }

        canvas {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
        }

        #left-edge-sensor {
            position: fixed;
            left: 0;
            top: 0;
            width: 20px; /* Smaller sensor area */
            height: 100vh;
            z-index: 999;
            /* For debugging: background-color: rgba(0, 255, 0, 0.05); */
        }

        #sidebar {
            width: var(--sidebar-width); height: 100vh; background-color: var(--sidebar-bg);
            border-right: 1px solid var(--sidebar-border-color);
            padding: 20px 15px; box-sizing: border-box;
            overflow-y: auto; transition: margin-left 0.30s ease-in-out;
            z-index: 1001; display: flex; flex-direction: column; gap: 20px;
            font-family: var(--font-family-main);
        }
        #sidebar.hidden { margin-left: calc(-1 * var(--sidebar-width)); }
        #sidebar h3 {
            margin-top: 0; margin-bottom: 10px; font-size: 1em;
            border-bottom: 1px solid var(--sidebar-border-color); padding-bottom: 8px;
            font-weight: 600; display: flex; align-items: center; gap: 8px;
        }
        #sidebar ul { list-style: none; padding: 0; margin: 0; max-height: 150px; overflow-y: auto; }
        #sidebar ul::-webkit-scrollbar { width: 5px; }
        #sidebar ul::-webkit-scrollbar-thumb { background-color: var(--sidebar-outline-color); border-radius: 8px; }

        #sidebar li {
            padding: 9px 15px; margin-bottom: 7px; border-radius: 7px;
            cursor: pointer; font-size: 0.9em; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
            transition: background-color 0.2s ease, box-shadow 0.2s ease, color 0.2s ease;
            background-color: var(--button-bg); box-shadow: 0 0 0 1px var(--sidebar-outline-color);
            color: var(--button-text-color);
        }
        #sidebar li:hover {
            background-color: var(--button-hover-bg);
            box-shadow: 0 0 0 1.5px var(--sidebar-outline-color);
        }
        #sidebar li .bookmark-url, #sidebar li .history-url {
            font-size: 0.75em; opacity: 0.7; display: block; margin-top: 2px;
        }

        #sidebar .sidebar-input {
            width: 100%; height: 38px; padding: 0 15px; margin-bottom: 10px;
            background-color: var(--input-bg); color: var(--text-color);
            border: none; border-radius: 7px; font-family: var(--font-family-main);
            box-sizing: border-box; box-shadow: 0 0 0 1px var(--sidebar-outline-color);
            font-size: 0.9em;
        }
        #sidebar .sidebar-input:focus {
            outline: none; background-color: var(--input-focus-bg); box-shadow: var(--input-focus-shadow);
        }

        #sidebar .sidebar-button {
            width: 100%; height: 38px; padding: 0 15px;
            background-color: var(--button-bg); color: var(--button-text-color);
            border: none; border-radius: 7px; cursor: pointer;
            transition: background-color 0.2s ease, box-shadow 0.2s ease, color 0.2s ease;
            font-family: var(--font-family-main); box-shadow: 0 0 0 1px var(--sidebar-outline-color);
            display: flex; align-items: center; justify-content: center;
            font-size: 0.9em; font-weight: 500;
        }
        #sidebar .sidebar-button:hover {
            background-color: var(--button-hover-bg);
            box-shadow: 0 0 0 1.5px var(--sidebar-outline-color);
        }

        .custom-dropdown {
            position: relative; width: 100%; margin-bottom: 10px; font-size: 0.9em;
            font-family: var(--font-family-main); color: var(--dropdown-text-color);
        }
        .custom-dropdown-header {
            width: 100%; height: 38px; padding: 0 15px; background-color: var(--dropdown-bg);
            border: none; border-radius: 7px; box-sizing: border-box;
            box-shadow: 0 0 0 1px var(--sidebar-outline-color); cursor: pointer;
            display: flex; align-items: center; justify-content: space-between;
            transition: background-color 0.2s ease, box-shadow 0.2s ease;
        }
        .custom-dropdown-header:hover { background-color: var(--dropdown-hover-bg); box-shadow: 0 0 0 1.5px var(--sidebar-outline-color); }
        .custom-dropdown-header:focus { outline: none; background-color: var(--dropdown-hover-bg); box-shadow: var(--input-focus-shadow); }
        .custom-dropdown-header .dropdown-chevron { margin-left: 10px; transition: transform 0.2s ease; } /* Changed from .fas */
        .custom-dropdown-header.open .dropdown-chevron { transform: rotate(180deg); }

        .custom-dropdown-list {
            position: absolute; top: 100%; left: 0; right: 0; background-color: var(--dropdown-bg);
            border-radius: 7px; box-shadow: 0 4px 8px rgba(var(--current-theme-shadow-rgb), var(--current-theme-shadow-opacity-strong));
            list-style: none; padding: 8px 0; margin: 4px 0 0 0; max-height: 180px; overflow-y: auto;
            z-index: 1005; display: none;
        }
        .custom-dropdown-list.show { display: block; }
        .custom-dropdown-list::-webkit-scrollbar { width: 5px; }
        .custom-dropdown-list::-webkit-scrollbar-thumb { background-color: var(--sidebar-outline-color); border-radius: 8px; }
        .custom-dropdown-list-item { padding: 7px 15px; cursor: pointer; transition: background-color 0.2s ease, color 0.2s ease; }
        .custom-dropdown-list-item:hover { background-color: var(--dropdown-item-hover-bg); color: var(--button-text-color); }
        .custom-dropdown-list-item.selected {
            font-weight: bold; background-color: color-mix(in srgb, var(--current-theme-accent) 30%, transparent);
            color: var(--button-text-color);
        }

        #main-content-wrapper { flex: 1; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        #top-bar-assembly { overflow: hidden; transition: max-height 0.25s ease-in-out; }
        #top-bar-assembly.hidden { max-height: 0 !important; border-bottom-width: 0; }

        body.app-ui-hidden #sidebar,
        body.app-ui-hidden #top-bar-assembly {
            display: none !important;
        }

        #tab-bar {
            display: flex; background-color: var(--navbar-bg); padding: 8px 10px;
            overflow-x: auto; white-space: nowrap; scrollbar-width: thin;
            position: relative; align-items: center; gap: 7px;
        }
        #tab-bar::-webkit-scrollbar { height: 3px; }
        #tab-bar::-webkit-scrollbar-thumb { background-color: var(--sidebar-outline-color); border-radius: 8px; }
        .tab {
            display: flex; align-items: center; min-width: 150px; max-width: 180px; height: 30px;
            padding: 0 10px; background-color: var(--tab-bg); border-radius: 6px; cursor: pointer;
            transition: all 0.2s ease; overflow: hidden; position: relative;
            box-shadow: 0 0 0 1px var(--tab-border);
        }
        .tab.active {
            background-color: var(--tab-active-bg); color: var(--button-text-color);
            box-shadow: 0 0 0 1px color-mix(in srgb, var(--current-theme-accent) 70%, var(--current-theme-text));
        }
        .tab.active .tab-title { color: var(--button-text-color); }
        .tab.active .tab-favicon .unicode-icon { color: var(--button-text-color); } /* For Unicode icons */
        .tab.active .tab-favicon img { filter: brightness(0) invert(1); }

        .tab:hover:not(.active) { background-color: var(--tab-hover-bg); }
        .tab-favicon { width: 16px; height: 16px; margin-right: 7px; flex-shrink: 0; display: flex; align-items: center; justify-content: center; font-size: 14px; }
        .tab-favicon img { width: 100%; height: 100%; object-fit: contain; }
        .tab-title { flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-size: 11px; color: var(--text-color); }
        .tab-close { width: 16px; height: 16px; display: flex; align-items: center; justify-content: center; border-radius: 50%; margin-left: 4px; flex-shrink: 0; opacity: 0.7; transition: opacity 0.2s, background-color 0.2s; font-size: 12px; line-height: 1; }
        .tab-close:hover { opacity: 1; background-color: rgba(var(--current-theme-shadow-rgb),0.2); }
        .new-tab-button {
            width: 30px; height: 30px; min-width: 30px; margin-left: 5px; border-radius: 25%;
            display: flex; align-items: center; justify-content: center; background-color: var(--button-bg);
            color: var(--button-text-color); cursor: pointer; transition: background-color 0.2s;
            box-shadow: 0 0 0 1px var(--sidebar-outline-color); font-size: 16px;
        }
        .new-tab-button:hover { background-color: var(--button-hover-bg); }

        #nav-bar {
            display: flex; align-items: center; padding: 8px 10px;
            background-color: var(--navbar-bg); box-shadow: var(--navbar-shadow);
            border-bottom: 1px solid var(--sidebar-border-color);
        }
        .nav-button {
            width: 36px; height: 36px; display: flex; align-items: center; justify-content: center;
            margin-right: 8px; border-radius: 25%; background-color: var(--button-bg);
            cursor: pointer; color: var(--button-text-color); transition: background-color 0.2s, color 0.2s;
            box-shadow: 0 0 0 1px var(--sidebar-outline-color); font-size: 18px; /* Adjust icon size if needed */
        }
        .nav-button:hover { background-color: var(--button-hover-bg); }

        #search-bar {
            flex: 1; height: 36px; border-radius: 6px; border: none; background-color: var(--input-bg);
            color: var(--text-color); padding: 0 15px; font-size: 14px;
            box-shadow: 0 0 0 1px var(--sidebar-outline-color); font-family: var(--font-family-main);
        }
        #search-bar:focus { outline: none; background-color: var(--input-focus-bg); box-shadow: var(--input-focus-shadow); }

        #tabs-container { flex: 1; position: relative; background-color: var(--iframe-bg); }
        .tab-content { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: none; border: none; }
        .tab-content.active { display: block; }
        .footer-label {
            position: fixed; bottom: 0; right: 0; margin: 1rem; font-family: var(--font-family-main);
            font-size: 0.9rem; color: var(--footer-text-color); text-decoration: none; z-index: 1000;
        }
        .sidebar-setting-label { display:block; margin-bottom:7px; font-size: 0.9em; font-weight: 500; }
        .unicode-icon { /* General class for unicode icons if specific styling is needed */
             font-size: inherit; /* Or set a specific size */
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <div id="left-edge-sensor"></div>

    <div id="sidebar">
        <div id="sidebar-header" style="padding-bottom: 10px; border-bottom: 1px solid var(--sidebar-border-color);">
            <h2 style="text-align: center; margin-bottom: 0; font-size: 1.4em; font-weight: bold;">Vern Max</h2>
        </div>

         <div id="settings-section">
            <h3><span class="unicode-icon">⚙️</span> Settings</h3>
            <label for="search-engine-dropdown" class="sidebar-setting-label" style="margin-top: 12px;">Search Engine:</label>
            <div class="custom-dropdown" id="search-engine-dropdown">
                <div class="custom-dropdown-header" tabindex="0" aria-haspopup="listbox" aria-expanded="false">
                    <span id="selected-search-engine-text">DuckDuckGo</span>
                    <span class="dropdown-chevron">▼</span>
                </div>
                <ul class="custom-dropdown-list" role="listbox">
                    <li class="custom-dropdown-list-item" data-value="duckduckgo" role="option">DuckDuckGo</li>
                    <li class="custom-dropdown-list-item" data-value="google" role="option">Google</li>
                    <li class="custom-dropdown-list-item" data-value="bing" role="option">Bing</li>
                    <li class="custom-dropdown-list-item" data-value="brave" role="option">Brave Search</li>
                </ul>
            </div>

            <label for="autoclose-delay-dropdown" class="sidebar-setting-label" style="margin-top: 12px;">Autoclose Delay:</label>
            <div class="custom-dropdown" id="autoclose-delay-dropdown">
                <div class="custom-dropdown-header" tabindex="0" aria-haspopup="listbox" aria-expanded="false">
                    <span id="selected-autoclose-delay-text">1 Second</span>
                    <span class="dropdown-chevron">▼</span>
                </div>
                <ul class="custom-dropdown-list" role="listbox">
                    <li class="custom-dropdown-list-item" data-value="0" role="option">Instant</li>
                    <li class="custom-dropdown-list-item" data-value="1000" role="option">1 Second</li>
                    <li class="custom-dropdown-list-item" data-value="3000" role="option">3 Seconds</li>
                    <li class="custom-dropdown-list-item" data-value="5000" role="option">5 Seconds</li>
                    <li class="custom-dropdown-list-item" data-value="10000" role="option">10 Seconds</li>
                </ul>
            </div>

            <label for="tab-cloak-dropdown" class="sidebar-setting-label" style="margin-top: 12px;">Tab Cloaking:</label>
            <div class="custom-dropdown" id="tab-cloak-dropdown">
                <div class="custom-dropdown-header" tabindex="0" aria-haspopup="listbox" aria-expanded="false">
                    <span id="selected-tab-cloak-text">None</span>
                    <span class="dropdown-chevron">▼</span>
                </div>
                <ul class="custom-dropdown-list" role="listbox">
                    <li class="custom-dropdown-list-item" data-value="none" role="option">None</li>
                    <li class="custom-dropdown-list-item" data-value="google_docs" role="option">Google Docs</li>
                    <li class="custom-dropdown-list-item" data-value="google_drive" role="option">Google Drive</li>
                    <li class="custom-dropdown-list-item" data-value="wikipedia" role="option">Wikipedia</li>
                    <li class="custom-dropdown-list-item" data-value="new_tab" role="option">New Tab (Local)</li>
                </ul>
            </div>
        </div>


        <div id="bookmarks-section">
            <h3><span class="unicode-icon">🔖</span> Bookmarks</h3>
            <input type="text" id="new-bookmark-name" class="sidebar-input" placeholder="Bookmark Name (optional)">
            <button id="add-current-bookmark-button" class="sidebar-button" style="margin-bottom:10px;">
                <span class="unicode-icon" style="margin-right: 8px;">+</span>Bookmark Current
            </button>
            <ul id="bookmarks-list"></ul>
        </div>

        <div id="history-section">
            <h3><span class="unicode-icon">🕒</span> Session History</h3>
            <ul id="history-list"></ul>
        </div>
    </div>

    <div id="main-content-wrapper">
        <div id="top-bar-assembly">
            <div id="tab-bar">
                <div class="new-tab-button" id="new-tab-button" title="New Tab">
                    <span class="unicode-icon">+</span>
                </div>
            </div>
            <div id="nav-bar">
                <div class="nav-button" id="home-button" title="Home"><span class="unicode-icon">⌂</span></div>
                <div class="nav-button" id="back-button" title="Back"><span class="unicode-icon">←</span></div>
                <div class="nav-button" id="forward-button" title="Forward"><span class="unicode-icon">→</span></div>
                <div class="nav-button" id="refresh-button" title="Refresh"><span class="unicode-icon">↻</span></div>
                <input type="text" id="search-bar" placeholder="Search or type a URL">
                <div class="nav-button" id="fullscreen-button" title="Toggle Fullscreen"><span class="unicode-icon">⤢</span></div>
            </div>
        </div>
        <div id="tabs-container"></div>
    </div>

    <a href="https://4simpleproblems.github.io" target="_blank" class="footer-label">Vern Max by 4SP</a>

    <script src="uv/uv.bundle.js" defer></script>
    <script src="uv/uv.config.js" defer></script>
    <script src="register-sw.js" defer></script>
    <script src="stars.js" defer></script>

    <script>
        // --- CONFIGURATION & GLOBAL STATE ---
        const TOP_EDGE_SENSITIVITY_Y = 5;

        let tabs = [];
        let activeTabId = null;
        let tabCounter = 0;
        let sessionHistory = [];
        const MAX_HISTORY_ITEMS = 50;

        const searchEngines = {
            'duckduckgo': { name: 'DuckDuckGo', url: 'https://duckduckgo.com/?q=%s' },
            'google': { name: 'Google', url: 'https://www.google.com/search?q=%s' },
            'bing': { name: 'Bing', url: 'https://www.bing.com/search?q=%s' },
            'brave': { name: 'Brave Search', url: 'https://search.brave.com/search?q=%s' }
        };
        let currentSearchEngineKey = 'duckduckgo';

        // Themes constant removed as there's only one default theme now

        const autoCloseDelayMap = {0: 'Instant', 1000: '1 Second', 3000: '3 Seconds', 5000: '5 Seconds', 10000: '10 Seconds'};
        let currentAutoCloseDelay = 1000;

        const cloakPresets = {
            'none': { title: null, faviconUrl: null },
            'google_docs': { title: 'Google Docs', faviconUrl: 'https://ssl.gstatic.com/docs/documents/images/kix-favicon7.ico' },
            'google_drive': { title: 'My Drive', faviconUrl: 'https://ssl.gstatic.com/images/branding/product/1x/drive_2020q4_32dp.png' },
            'wikipedia': { title: 'Wikipedia', faviconUrl: 'https://en.wikipedia.org/static/favicon/wikipedia.ico' },
            'new_tab': { title: 'New Tab', faviconUrl: 'logo.png' }
        };
        let currentCloakPresetKey = 'none';

        // --- DOM ELEMENT REFERENCES ---
        let tabBarEl, tabsContainerEl, searchBarEl, newTabButtonEl, homeButtonEl, backButtonEl, forwardButtonEl, refreshButtonEl, fullscreenButtonEl;
        let topBarAssemblyEl;
        let sidebarEl, mainContentWrapperEl, leftEdgeSensorEl;
        let bookmarksListEl, addCurrentBookmarkButtonEl, newBookmarkNameInputEl;
        let historyListEl;
        let searchEngineDropdownEl, autoCloseDelayDropdownEl, tabCloakDropdownEl; // themeDropdownEl removed

        let initialTopBarHeight = 0;
        let isTopBarHidden = true;
        let isSidebarHidden = true;

        let topBarAutoHideTimeoutId = null;
        let sidebarAutoHideTimeoutId = null;

        let isMouseOverTopBar = false;
        let isMouseOverSidebar = false;
        let isSearchBarFocused = false;
        let isSidebarInputFocused = false;


        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', async () => {
            tabBarEl = document.getElementById('tab-bar');
            tabsContainerEl = document.getElementById('tabs-container');
            searchBarEl = document.getElementById('search-bar');
            newTabButtonEl = document.getElementById('new-tab-button');
            homeButtonEl = document.getElementById('home-button');
            backButtonEl = document.getElementById('back-button');
            forwardButtonEl = document.getElementById('forward-button');
            refreshButtonEl = document.getElementById('refresh-button');
            fullscreenButtonEl = document.getElementById('fullscreen-button');

            topBarAssemblyEl = document.getElementById('top-bar-assembly');
            sidebarEl = document.getElementById('sidebar');
            mainContentWrapperEl = document.getElementById('main-content-wrapper');
            leftEdgeSensorEl = document.getElementById('left-edge-sensor');

            bookmarksListEl = document.getElementById('bookmarks-list');
            addCurrentBookmarkButtonEl = document.getElementById('add-current-bookmark-button');
            newBookmarkNameInputEl = document.getElementById('new-bookmark-name');
            historyListEl = document.getElementById('history-list');

            // themeDropdownEl removed
            searchEngineDropdownEl = document.getElementById('search-engine-dropdown');
            autoCloseDelayDropdownEl = document.getElementById('autoclose-delay-dropdown');
            tabCloakDropdownEl = document.getElementById('tab-cloak-dropdown');

            await initUV();
            setupCustomDropdowns();
            loadSettings();

            updateInitialTopBarHeight();
            handleTopBarToggle(isTopBarHidden, true);
            handleSidebarToggle(isSidebarHidden, true);

            setupEventListeners();
            loadBookmarks();

            const urlParams = new URLSearchParams(window.location.search);
            const initialUrl = urlParams.get('url');
            if (tabs.length === 0) createTab(initialUrl || 'about:blank');
            renderHistory();
            const activeTabForCloak = getActiveTab();
            if (activeTabForCloak) updateTabInfo(activeTabForCloak, activeTabForCloak.actualTitle, activeTabForCloak.actualFavicon);
        });

        async function initUV() { /* ... (no change) ... */ }

        function setupCustomDropdowns() {
            // Theme dropdown population removed
            const searchEngineListEl = searchEngineDropdownEl.querySelector('.custom-dropdown-list');
            searchEngineListEl.innerHTML = '';
            for (const value in searchEngines) { const li = document.createElement('li'); li.className = 'custom-dropdown-list-item'; li.dataset.value = value; li.textContent = searchEngines[value].name; li.setAttribute('role', 'option'); searchEngineListEl.appendChild(li); }

            const autoCloseListEl = autoCloseDelayDropdownEl.querySelector('.custom-dropdown-list');
            autoCloseListEl.innerHTML = '';
            for (const value in autoCloseDelayMap) { const li = document.createElement('li'); li.className = 'custom-dropdown-list-item'; li.dataset.value = value; li.textContent = autoCloseDelayMap[value]; li.setAttribute('role', 'option'); autoCloseListEl.appendChild(li); }

            const tabCloakListEl = tabCloakDropdownEl.querySelector('.custom-dropdown-list');
            tabCloakListEl.innerHTML = '';
            for (const value in cloakPresets) { const li = document.createElement('li'); li.className = 'custom-dropdown-list-item'; li.dataset.value = value; li.textContent = cloakPresets[value].title || "None (Show Actual)"; li.setAttribute('role', 'option'); tabCloakListEl.appendChild(li); }


            document.querySelectorAll('.custom-dropdown-header').forEach(header => { header.addEventListener('click', toggleDropdown); header.addEventListener('keydown', handleDropdownKeyDown); });
            document.querySelectorAll('.custom-dropdown-list-item').forEach(item => { item.addEventListener('click', selectDropdownItem); item.addEventListener('keydown', handleDropdownItemKeyDown); });
            document.addEventListener('click', (e) => { document.querySelectorAll('.custom-dropdown-list.show').forEach(list => { if (!list.parentNode.contains(e.target)) { list.classList.remove('show'); const header = list.parentNode.querySelector('.custom-dropdown-header'); header.classList.remove('open'); header.setAttribute('aria-expanded', 'false'); } }); });
            document.addEventListener('focusin', (e) => { document.querySelectorAll('.custom-dropdown-list.show').forEach(list => { if (!list.parentNode.contains(e.target) && !list.parentNode.querySelector('.custom-dropdown-header').contains(e.target)) { list.classList.remove('show'); const header = list.parentNode.querySelector('.custom-dropdown-header'); header.classList.remove('open'); header.setAttribute('aria-expanded', 'false'); } }); });
        }

        function toggleDropdown() { /* ... (no change) ... */ }
        function handleDropdownKeyDown(e) { /* ... (no change) ... */ }

        function selectDropdownItem() {
            const item = this; const dropdown = item.closest('.custom-dropdown');
            const header = dropdown.querySelector('.custom-dropdown-header'); const list = dropdown.querySelector('.custom-dropdown-list');
            const value = item.dataset.value;
            updateSelectedDropdownText(dropdown.id, value);
            list.classList.remove('show'); header.classList.remove('open'); header.setAttribute('aria-expanded', 'false'); header.focus();

            // Theme selection logic removed
            if (dropdown.id === 'search-engine-dropdown') { currentSearchEngineKey = value; localStorage.setItem('vernSearchEngine', currentSearchEngineKey); }
            else if (dropdown.id === 'autoclose-delay-dropdown') { currentAutoCloseDelay = parseInt(value, 10); localStorage.setItem('vernAutoCloseDelay', currentAutoCloseDelay); }
            else if (dropdown.id === 'tab-cloak-dropdown') {
                currentCloakPresetKey = value; localStorage.setItem('vernCloakPreset', currentCloakPresetKey);
                const activeTab = getActiveTab();
                if (activeTab) updateTabInfo(activeTab, activeTab.actualTitle, activeTab.actualFavicon);
            }
        }
        function handleDropdownItemKeyDown(e) { /* ... (no change) ... */ }
        function updateSelectedDropdownText(dropdownId, selectedValue) {
            const dropdownEl = document.getElementById(dropdownId); if (!dropdownEl) return;
            const selectedTextEl = dropdownEl.querySelector('.custom-dropdown-header span');
            const listItems = dropdownEl.querySelectorAll('.custom-dropdown-list-item'); let newText = '';
            listItems.forEach(item => {
                if (item.dataset.value === selectedValue) { item.classList.add('selected'); item.setAttribute('aria-selected', 'true'); newText = item.textContent; }
                else { item.classList.remove('selected'); item.setAttribute('aria-selected', 'false'); }
            });
            if (selectedTextEl && newText) selectedTextEl.textContent = newText;
            else if (selectedTextEl && dropdownId === 'tab-cloak-dropdown' && selectedValue === 'none') selectedTextEl.textContent = "None (Show Actual)";
        }


        function loadSettings() {
            // Theme loading removed - default is in CSS :root
            currentSearchEngineKey = localStorage.getItem('vernSearchEngine') || 'duckduckgo'; updateSelectedDropdownText('search-engine-dropdown', currentSearchEngineKey);
            currentAutoCloseDelay = parseInt(localStorage.getItem('vernAutoCloseDelay') || '1000', 10); updateSelectedDropdownText('autoclose-delay-dropdown', currentAutoCloseDelay.toString());
            currentCloakPresetKey = localStorage.getItem('vernCloakPreset') || 'none'; updateSelectedDropdownText('tab-cloak-dropdown', currentCloakPresetKey);
            isTopBarHidden = localStorage.getItem('vernIsTopBarHidden') !== 'false';
            isSidebarHidden = localStorage.getItem('vernIsSidebarHidden') !== 'false';
        }

        function setupEventListeners() {
            fullscreenButtonEl.addEventListener('click', toggleIframeFullscreen);
            document.addEventListener('fullscreenchange', handleFullscreenChange);

            window.addEventListener('resize', () => { updateInitialTopBarHeight(); if (!isTopBarHidden) topBarAssemblyEl.style.maxHeight = initialTopBarHeight + 'px'; });
            newTabButtonEl.addEventListener('click', () => createTab('about:blank'));
            tabBarEl.addEventListener('click', handleTabBarClick);
            searchBarEl.addEventListener('keydown', handleSearchEnter);
            homeButtonEl.addEventListener('click', () => navigateTo('about:blank'));
            backButtonEl.addEventListener('click', () => getActiveTab()?.iframe.contentWindow.history.back());
            forwardButtonEl.addEventListener('click', () => getActiveTab()?.iframe.contentWindow.history.forward());
            refreshButtonEl.addEventListener('click', () => { const activeTab=getActiveTab(); if(activeTab?.iframe.contentWindow){try{if(activeTab.iframe.src.includes(__uv$config.prefix))activeTab.iframe.contentWindow.location.reload(true);else activeTab.iframe.contentWindow.location.reload();}catch(e){activeTab.iframe.src=activeTab.iframe.src;}} });
            addCurrentBookmarkButtonEl.addEventListener('click', handleAddCurrentBookmark);
            bookmarksListEl.addEventListener('click', handleBookmarkClick);
            historyListEl.addEventListener('click', handleHistoryClick);
            document.addEventListener('keydown', handleGlobalKeyDown);
            document.addEventListener('load', handleIframeLoad, true);

            document.addEventListener('mousemove', handleDocumentMouseMove); // For top edge only
            leftEdgeSensorEl.addEventListener('mouseenter', () => {
                clearAllAutoHideTimeouts();
                if (isSidebarHidden) showSidebar();
                if (isTopBarHidden) showTopBar();
            });
            leftEdgeSensorEl.addEventListener('mouseleave', scheduleAutoHideOfBars);

            topBarAssemblyEl.addEventListener('mouseenter', () => { isMouseOverTopBar = true; clearAllAutoHideTimeouts(); });
            topBarAssemblyEl.addEventListener('mouseleave', () => { isMouseOverTopBar = false; scheduleAutoHideOfBars(); });
            sidebarEl.addEventListener('mouseenter', () => { isMouseOverSidebar = true; clearAllAutoHideTimeouts(); });
            sidebarEl.addEventListener('mouseleave', () => { isMouseOverSidebar = false; scheduleAutoHideOfBars(); });
            searchBarEl.addEventListener('focus', () => { isSearchBarFocused = true; clearAllAutoHideTimeouts(); if (isTopBarHidden) showTopBar(); });
            searchBarEl.addEventListener('blur', () => { isSearchBarFocused = false; scheduleAutoHideOfBars(); });
            sidebarEl.addEventListener('focusin', (event) => { if(event.target.closest('.sidebar-input, .sidebar-button, .custom-dropdown-header')) { isSidebarInputFocused = true; clearAllAutoHideTimeouts(); if (isSidebarHidden) showSidebar();}});
            sidebarEl.addEventListener('focusout', (event) => { if(event.target.closest('.sidebar-input, .sidebar-button, .custom-dropdown-header')) { isSidebarInputFocused = false; scheduleAutoHideOfBars(); }});
        }

        function toggleIframeFullscreen() {
            if (!document.fullscreenElement) {
                const activeTab = getActiveTab();
                if (activeTab && activeTab.iframe) activeTab.iframe.requestFullscreen().catch(err => console.error("Fullscreen request failed:", err));
            } else { if (document.exitFullscreen) document.exitFullscreen(); }
        }
        function handleFullscreenChange() {
            const fsIconEl = fullscreenButtonEl.querySelector('.unicode-icon'); // Target the span
            if (document.fullscreenElement) {
                document.body.classList.add('app-ui-hidden');
                if(fsIconEl) fsIconEl.textContent = '⤡'; // Compress
            } else {
                document.body.classList.remove('app-ui-hidden');
                if(fsIconEl) fsIconEl.textContent = '⤢'; // Expand
                scheduleAutoHideOfBars();
            }
        }

        function handleDocumentMouseMove(event) {
            if (event.clientY <= TOP_EDGE_SENSITIVITY_Y && isTopBarHidden) showTopBar();
        }

        function clearAllAutoHideTimeouts() {
            clearTimeout(topBarAutoHideTimeoutId);
            clearTimeout(sidebarAutoHideTimeoutId);
        }

        function scheduleAutoHideOfBars() {
            clearAllAutoHideTimeouts();

            if (isMouseOverSidebar || isMouseOverTopBar || isSearchBarFocused || isSidebarInputFocused) {
                return; // Conditions met to keep bars open
            }

            const delay = currentAutoCloseDelay;

            if (!isSidebarHidden) {
                if (delay === 0) {
                    handleSidebarToggle(true);
                } else {
                    sidebarAutoHideTimeoutId = setTimeout(() => {
                        if (!isMouseOverSidebar && !isMouseOverTopBar && !isSidebarInputFocused) { // Re-check critical conditions
                           if(!isSidebarHidden) handleSidebarToggle(true);
                        }
                    }, delay);
                }
            }

            if (!isTopBarHidden) {
                 if (delay === 0) {
                    handleTopBarToggle(true);
                } else {
                    topBarAutoHideTimeoutId = setTimeout(() => {
                         if (!isMouseOverSidebar && !isMouseOverTopBar && !isSearchBarFocused) { // Re-check critical conditions
                            if(!isTopBarHidden) handleTopBarToggle(true);
                         }
                    }, delay);
                }
            }
        }

        function showTopBar() { clearTimeout(topBarAutoHideTimeoutId); if (isTopBarHidden) handleTopBarToggle(false); }
        function showSidebar() { clearTimeout(sidebarAutoHideTimeoutId); if (isSidebarHidden) handleSidebarToggle(false); }
        // attemptTopBarAutoHide and attemptSidebarAutoHide are replaced by scheduleAutoHideOfBars

        function createTab(url = null) {
            const tabId = `tab-${tabCounter++}`; const tabElement = document.createElement('div'); tabElement.className = 'tab'; tabElement.dataset.tabId = tabId;
            tabElement.innerHTML = `<div class="tab-favicon"><span class="unicode-icon">🌐</span></div><div class="tab-title">New Tab</div><div class="tab-close"><span class="unicode-icon">×</span></div>`; // Default generic globe
            tabBarEl.insertBefore(tabElement, newTabButtonEl); const iframe = document.createElement('iframe'); iframe.id = `content-${tabId}`; iframe.className = 'tab-content';
            iframe.sandbox = 'allow-scripts allow-same-origin allow-forms allow-popups allow-presentation allow-downloads allow-popups-to-escape-sandbox'; iframe.loading = 'eager'; tabsContainerEl.appendChild(iframe);
            const tab = { id: tabId, element: tabElement, iframe, url: url || 'about:blank', actualTitle: 'New Tab', actualFavicon: null, titleElement: tabElement.querySelector('.tab-title'), faviconElement: tabElement.querySelector('.tab-favicon'), isLoading: false };
            tabs.push(tab); activateTab(tabId); navigateTo(tab.url, tab); return tab;
        }
        function activateTab(tabId) {
            if (!tabId && tabs.length > 0) tabId = tabs[0].id; if (!tabId) return;
            tabs.forEach(t => { t.element.classList.remove('active'); t.iframe.classList.remove('active'); });
            const tab = tabs.find(t => t.id === tabId);
            if (tab) { tab.element.classList.add('active'); tab.iframe.classList.add('active'); activeTabId = tabId; searchBarEl.value = (tab.url && tab.url !== 'about:blank' && !tab.url.startsWith('about:error')) ? tab.url : ''; tab.element.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'nearest' }); updateTabInfo(tab, tab.actualTitle, tab.actualFavicon); document.title = "VERN MAX - SEARCH"; }
        }
        function closeTab(tabId) { /* ... (no change) ... */ }
        function getActiveTab() { return tabs.find(t => t.id === activeTabId); }

        function updateTabInfo(tab, actualPageTitle, actualPageFaviconUrl) {
            if (!tab) return;
            tab.actualTitle = actualPageTitle || tab.actualTitle || (tab.url === 'about:blank' ? 'New Tab' : (tab.url || 'Loading...'));
            tab.actualFavicon = actualPageFaviconUrl || tab.actualFavicon;
            const cloak = cloakPresets[currentCloakPresetKey] || cloakPresets['none'];
            let displayTitleOnTab, displayFaviconUrlOnTab;
            if (currentCloakPresetKey !== 'none' && cloak.title) { displayTitleOnTab = cloak.title; displayFaviconUrlOnTab = cloak.faviconUrl; }
            else { displayTitleOnTab = tab.actualTitle; displayFaviconUrlOnTab = tab.actualFavicon; }
            tab.titleElement.textContent = displayTitleOnTab.length > 20 ? displayTitleOnTab.substring(0, 18) + '...' : displayTitleOnTab;
            tab.titleElement.title = displayTitleOnTab;
            if (displayFaviconUrlOnTab) tab.faviconElement.innerHTML = `<img src="${displayFaviconUrlOnTab}" alt="" onerror="this.parentNode.innerHTML = '<span class=\\'unicode-icon\\'>🌐</span>';">`;
            else if (tab.url && tab.url !== 'about:blank' && tab.url.startsWith('http') && (!cloakPresets[currentCloakPresetKey] || !cloakPresets[currentCloakPresetKey].faviconUrl)) { try { const siteUrl = new URL(tab.url); tab.faviconElement.innerHTML = `<img src="${siteUrl.protocol}//${siteUrl.hostname}/favicon.ico" alt="" onerror="this.parentNode.innerHTML = '<span class=\\'unicode-icon\\'>🌐</span>';">`; } catch (e) { tab.faviconElement.innerHTML = `<span class="unicode-icon">🌐</span>`; } }
            else { tab.faviconElement.innerHTML = `<span class="unicode-icon">🌐</span>`; } // Default generic globe
            document.title = "VERN MAX - SEARCH";
        }

        function formatUrlInput(input) { /* ... (no change) ... */ }
        function navigateTo(urlInput, tab = null) { /* ... (no change, actualTitle is used for history) ... */ }

        function handleTopBarToggle(forceHide, initialSet = false) {
            const shouldHide = forceHide;
            if (shouldHide) {
                if (!isTopBarHidden || initialSet) { isTopBarHidden = true; topBarAssemblyEl.classList.add('hidden'); topBarAssemblyEl.style.maxHeight = '0px'; if (!initialSet) localStorage.setItem('vernIsTopBarHidden', 'true'); }
            } else {
                if (isTopBarHidden || initialSet) { isTopBarHidden = false; updateInitialTopBarHeight(); topBarAssemblyEl.classList.remove('hidden'); topBarAssemblyEl.style.maxHeight = initialTopBarHeight + 'px'; if (!initialSet) localStorage.setItem('vernIsTopBarHidden', 'false'); }
                else if (!topBarAssemblyEl.classList.contains('hidden') && parseFloat(topBarAssemblyEl.style.maxHeight || "0") < initialTopBarHeight / 2 && initialTopBarHeight > 0) topBarAssemblyEl.style.maxHeight = initialTopBarHeight + 'px';
            }
        }
        function handleSidebarToggle(forceHide, initialSet = false) {
            const shouldHide = forceHide;
            if (shouldHide) { if (!isSidebarHidden || initialSet) { isSidebarHidden = true; sidebarEl.classList.add('hidden'); if(!initialSet)localStorage.setItem('vernIsSidebarHidden', 'true'); }}
            else { if (isSidebarHidden || initialSet) { isSidebarHidden = false; sidebarEl.classList.remove('hidden'); if(!initialSet)localStorage.setItem('vernIsSidebarHidden', 'false'); }}
        }
        function updateInitialTopBarHeight() { /* ... (no change) ... */ }

        function handleTabBarClick(e) { const tabElement = e.target.closest('.tab'); const closeButton = e.target.closest('.tab-close .unicode-icon'); if (closeButton && tabElement) { e.stopPropagation(); closeTab(tabElement.dataset.tabId); } else if (tabElement) activateTab(tabElement.dataset.tabId); }
        function handleSearchEnter(e) { if (e.key === 'Enter') navigateTo(e.target.value); }
        function handleIframeLoad(event) {
            if (event.target.tagName === 'IFRAME' && event.target.classList.contains('tab-content')) {
                const iframe = event.target; const tab = tabs.find(t => t.iframe === iframe);
                if (tab) {
                    tab.isLoading = false; let titleFromIframe = 'Untitled'; let faviconFromIframe = null;
                    try {
                        if (iframe.contentWindow && iframe.contentDocument) {
                            titleFromIframe = iframe.contentDocument.title || new URL(tab.url).hostname || 'Untitled';
                            const linkTags = iframe.contentDocument.head.querySelectorAll('link[rel*="icon"]');
                            if (linkTags.length > 0) { try {faviconFromIframe = new URL(linkTags[0].href, iframe.contentWindow.location.href).href; } catch(e){/*ignore invalid favicons*/} }
                        }
                    } catch (e) { try { titleFromIframe = new URL(tab.url).hostname || 'New Tab'; } catch {} }
                    if(tab.url && tab.url.startsWith('about:error')) titleFromIframe = "Error Page";
                    updateTabInfo(tab, titleFromIframe, faviconFromIframe);
                    if (tab.url && !tab.url.startsWith('about:error') && !tab.url.startsWith('about:blank')) addToHistory(tab.actualTitle, tab.url);
                    setupTitleObserver(tab);
                }
            }
        }
        function handleGlobalKeyDown(e) { const targetTagName = e.target.tagName.toLowerCase(); if (targetTagName === 'input' || targetTagName === 'textarea' || targetTagName === 'select' || e.target.isContentEditable) return; if ((e.ctrlKey || e.metaKey) && e.key === 't') { e.preventDefault(); createTab('about:blank'); } if ((e.ctrlKey || e.metaKey) && e.key === 'w') { e.preventDefault(); if (activeTabId) closeTab(activeTabId); } if (e.ctrlKey && e.key === 'Tab') { e.preventDefault(); if (tabs.length > 1) { const currentIndex = tabs.findIndex(t => t.id === activeTabId); const nextIndex = (currentIndex + (e.shiftKey ? -1 : 1) + tabs.length) % tabs.length; activateTab(tabs[nextIndex].id); }} if (e.altKey && e.key === 'ArrowLeft') { e.preventDefault(); backButtonEl.click(); } if (e.altKey && e.key === 'ArrowRight') { e.preventDefault(); forwardButtonEl.click(); } if (e.key === 'F5' || ((e.ctrlKey || e.metaKey) && e.key === 'r')) { e.preventDefault(); refreshButtonEl.click(); } if ((e.ctrlKey || e.metaKey) && e.key === 'l') { e.preventDefault(); searchBarEl.focus(); searchBarEl.select(); }}
        function setupTitleObserver(tab) {
             if (!tab || !tab.iframe.contentWindow) return; if (tab.titleObserver) tab.titleObserver.disconnect();
            try {
                const targetNode = tab.iframe.contentDocument.querySelector('title'); if (!targetNode) return;
                const observer = new MutationObserver(() => { if (tab.iframe.contentDocument) {
                    let titleFromIframe = tab.iframe.contentDocument.title; let faviconFromIframe = tab.actualFavicon;
                    const linkTags = tab.iframe.contentDocument.head.querySelectorAll('link[rel*="icon"]');
                    if (linkTags.length > 0) { try {faviconFromIframe = new URL(linkTags[0].href, tab.iframe.contentWindow.location.href).href;}catch(e){} }
                    updateTabInfo(tab, titleFromIframe, faviconFromIframe);
                }});
                observer.observe(targetNode, { subtree: true, characterData: true, childList: true }); tab.titleObserver = observer;
            } catch (e) { if (tab.locationCheckIntervalId) clearInterval(tab.locationCheckIntervalId); tab.locationCheckIntervalId = setInterval(() => { try { if (tab.iframe.contentDocument && tab.actualTitle !== tab.iframe.contentDocument.title) {let title = tab.iframe.contentDocument.title; let fav = tab.actualFavicon; const links = tab.iframe.contentDocument.head.querySelectorAll('link[rel*="icon"]'); if(links.length>0){try{fav=new URL(links[0].href, tab.iframe.contentWindow.location.href).href;}catch(e){}} updateTabInfo(tab, title, fav);}} catch (err) {} }, 2000); }
        }
        function loadBookmarks() { const bms = JSON.parse(localStorage.getItem('vernBookmarks') || '[]'); bookmarksListEl.innerHTML = ''; bms.forEach(bm => renderBookmarkItem(bm));}
        function saveBookmarks(bms) { localStorage.setItem('vernBookmarks', JSON.stringify(bms)); }
        function renderBookmarkItem(bm) { const li = document.createElement('li'); li.dataset.url = bm.url; li.title = `${bm.name}\n${bm.url}`; const nameSpan = document.createElement('span'); nameSpan.textContent = bm.name.length > 20 ? bm.name.substring(0,18) + '...' : bm.name; const urlSpan = document.createElement('span'); urlSpan.className = 'bookmark-url'; urlSpan.textContent = bm.url.length > 25 ? bm.url.substring(0, 22) + '...' : bm.url; const removeBtn = document.createElement('span'); removeBtn.className = 'unicode-icon'; removeBtn.textContent = '×'; removeBtn.style.cssText = 'position:absolute; right:12px; top:50%; transform:translateY(-50%); cursor:pointer; padding: 5px; opacity: 0.7; font-size: 1em;'; removeBtn.onclick = (e) => { e.stopPropagation(); removeBookmark(bm.url); }; li.appendChild(nameSpan); li.appendChild(urlSpan); li.appendChild(removeBtn); li.style.position = 'relative'; bookmarksListEl.appendChild(li); }
        function handleAddCurrentBookmark() {
            const activeTab = getActiveTab(); if (!activeTab || !activeTab.url || activeTab.url === 'about:blank' || activeTab.url.startsWith('about:')) { alert("Cannot bookmark this page."); return; }
            const name = newBookmarkNameInputEl.value.trim() || activeTab.actualTitle || new URL(activeTab.url).hostname;
            const url = activeTab.url; let bms = JSON.parse(localStorage.getItem('vernBookmarks') || '[]');
            if (bms.some(b => b.url === url)) { alert("This page is already bookmarked."); return; }
            bms.push({ name, url }); saveBookmarks(bms); renderBookmarkItem({ name, url }); newBookmarkNameInputEl.value = '';
        }
        function removeBookmark(urlToRemove) { let bms = JSON.parse(localStorage.getItem('vernBookmarks') || '[]'); bms = bms.filter(b => b.url !== urlToRemove); saveBookmarks(bms); loadBookmarks(); }
        function handleBookmarkClick(e) { const li = e.target.closest('li[data-url]'); if (li && !e.target.classList.contains('unicode-icon')) { createTab(li.dataset.url); if (!isSidebarHidden && window.innerWidth < 768) handleSidebarToggle(true); }} // Check for unicode-icon class now
        function addToHistory(title, url) { if (!url || url === 'about:blank' || url.startsWith('about:')) return; if (sessionHistory.length > 0 && sessionHistory[sessionHistory.length - 1].url === url && sessionHistory[sessionHistory.length - 1].title === title) return; sessionHistory.push({ title: title || url, url, timestamp: new Date() }); if (sessionHistory.length > MAX_HISTORY_ITEMS) sessionHistory.shift(); renderHistory(); }
        function renderHistory() { historyListEl.innerHTML = ''; [...sessionHistory].reverse().forEach(item => { const li = document.createElement('li'); li.dataset.url = item.url; li.title = `${item.title}\n${item.url}\n${item.timestamp.toLocaleTimeString()}`; const titleSpan = document.createElement('span'); titleSpan.textContent = item.title && item.title.length > 22 ? item.title.substring(0,19) + '...' : item.title || item.url; const urlSpan = document.createElement('span'); urlSpan.className = 'history-url'; urlSpan.textContent = item.url.length > 25 ? item.url.substring(0, 22) + '...' : item.url; li.appendChild(titleSpan); li.appendChild(urlSpan); historyListEl.appendChild(li); });}
        function handleHistoryClick(e) { const li = e.target.closest('li[data-url]'); if (li) { navigateTo(li.dataset.url); if (!isSidebarHidden && window.innerWidth < 768) handleSidebarToggle(true);}}
        // applyTheme function removed as theme is now static in :root
    </script>
</body>
</html>
